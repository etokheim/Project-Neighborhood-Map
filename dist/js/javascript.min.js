function getKeywords(e){return"hike"===e?{keywords:["Fjelltur","Tur"],icon:"fa fa-compass fa-lg"}:"restaurant"===e?{keywords:["Restaurant"],icon:"fa fa-compass fa-lg"}:"landmark"===e?{keywords:["Severdighet"],icon:"fa fa-map-marker fa-lg"}:void 0}function sendItemsToSearch(e){for(var t=[],i=0;i<markers().length;i++)filter().active()?(markerVisibillity(markers()[i],!1),"Fjelltur"==markers()[i].type.keywords[0]&&filter().type.hike()?(markerVisibillity(markers()[i],!0),console.log("Pushing "+markers()[i].koTitle()),t.push({title:markers()[i].koTitle().toLowerCase(),index:i})):"Restaurant"==markers()[i].type.keywords[0]&&filter().type.restaurant()?(markerVisibillity(markers()[i],!0),console.log("Pushing "+markers()[i].koTitle()),t.push({title:markers()[i].koTitle().toLowerCase(),index:i})):"Severdighet"==markers()[i].type.keywords[0]&&filter().type.landmark()&&(markerVisibillity(markers()[i],!0),console.log("Pushing "+markers()[i].koTitle()),t.push({title:markers()[i].koTitle().toLowerCase(),index:i}))):(markerVisibillity(markers()[i],!0),console.log("filter().active() = "+filter().active()+", pushing: "+markers()[i].koTitle()),t.push({title:markers()[i].koTitle().toLowerCase(),index:i}));console.log(e),console.log(t),search(e,t)}function markerVisibillity(e,t){console.log("HIDIIIIIIIIIIIIIIIIIIIIIIING "+e.koTitle()),e.visible2(t),e.setVisible(t)}function search(e,t){e=e.toLowerCase(),console.log(e+t.title);var i=t.filter(function(t){for(var i=-1,o=0;o<e.length;o++){var r=e[o];if(" "!=r){if(i=t.title.indexOf(r,i+1),i==-1)return console.log("NOT FOUND: searchItem = "+r+", posOfLastFound = "+i+", item = "+t.title),markerVisibillity(markers()[t.index],!1),!1;console.log("FOUND    : searchItem = "+r+", posOfLastFound = "+i+", item = "+t.title+" ===== "+markers()[t.index].koTitle()),markerVisibillity(markers()[t.index],!0)}}return!0});console.log(i)}function getExternalResources(){markersLength=markers().length;for(var e=0;e<markersLength;e++)ajax.title=markers()[e].koTitle(),$.ajax({url:"https://no.wikipedia.org/w/api.php?prop=info%7Cextracts",dataType:"jsonp",data:{titles:ajax.title,action:"query",inprop:"url",format:"json",requestid:e},success:function(e){clearTimeout(wikipediaErrorHandling);var t=Object.getOwnPropertyNames(e.query.pages)[0],i=e.query.pages,o=i[t].extract,r=o.split("</p>"),a="",l="";if(r[0].length<=3){l=r[1],articleTextLength=r.length;for(var n=2;n<articleTextLength;n++)a+=r[n]}else{l=r[0],articleTextLength=r.length;for(var n=1;n<articleTextLength;n++)a+=r[n]}markers()[e.requestid].wikipedia.ingress(l),markers()[e.requestid].wikipedia.bodyText(a),markers()[e.requestid].wikipedia.url(i[t].fullurl),e.requestid++}}),function(e){$.ajax({url:ajax.flickr.url,type:"GET",dataType:"text",data:{method:"flickr.photos.search",text:markers()[e].koTitle(),format:"json",api_key:ajax.flickr.key}}).done(function(t){var i=JSON.parse(t.slice(14,t.length-1)),o="https://www.flickr.com/services/rest/?&?callback=?";$.ajax({url:o,dataType:"text",data:{method:"flickr.photos.getSizes",photo_id:i.photos.photo[0].id,format:"json",api_key:ajax.flickr.key}}).done(function(t){var i=JSON.parse(t.slice(14,t.length-1));markers()[e].flickr.img().push(i.sizes.size[5].source),markers()[e].flickr.img().push(i.sizes.size[6].source),markers()[e].flickr.img().push(i.sizes.size[7].source)}).fail(function(e,t,i){console.log("fail2"),console.log(e)})}).fail(function(e,t,i){console.log("Error: "+i),console.log("Status: "+t),console.dir(e)})}(e)}function jsonFlickrApi(e){}function toggleLocationSwitcher(){locationSwitcher.displaying=!locationSwitcher.displaying,$(".location_switcher_container").toggleClass("location_switcher_container_hidden")}function toggleLocationSwitcherList(e){if("hide"===e&&locationList.displaying)locationList.displaying=!locationList.displaying,$(".location_switcher_list_container").toggleClass("location_switcher_list_container_hidden");else{if("hide"===e)return"Already hidden";locationList.displaying=!locationList.displaying,$(".location_switcher_list_container").toggleClass("location_switcher_list_container_hidden")}}function toggleFeatured(e){$(".featured_container").eq(e).toggleClass("featured_container_hidden")}function displayAvailableFeaturedContainer(e){featured.displaying===!1?(toggleFeatured(0),featured.displaying=0,toggleLocationSwitcher(),toggleLocationSwitcherList("hide")):0===featured.displaying?(toggleFeatured(0),toggleFeatured(1),featured.displaying=1):1===featured.displaying&&(toggleFeatured(1),toggleFeatured(0),featured.displaying=0),populateFeatured(featured.displaying,e)}function hideFeaturedContainer(){$(".featured_container").eq(featured.displaying).toggleClass("featured_container_hidden"),toggleLocationSwitcher(),featured.displaying=!1}function displayBodyText(e){$(".article_body").eq(e).toggleClass("article_body_hidden"),$(".article_body_read_more").eq(e).toggleClass("article_body_read_more_hidden"),$(".article_body_read_more_button").eq(e).toggleClass("article_body_read_more_button_hidden")}function populateFeatured(e,t){featuredContent().first.title(markers()[t].koTitle());var i=markers()[t].wikipedia.ingress(),o=markers()[t].wikipedia.url(),r=markers()[t].flickr.img();featuredContent().first.wikipedia().ingress(i),featuredContent().first.wikipedia().bodyText(markers()[t].wikipedia.bodyText()),featuredContent().first.wikipedia().url(o),featuredContent().first.flickr().img(r)}function clearFeatured(e){}function readMore(e){console.log(e),displayAvailableFeaturedContainer(e),infoWindow.closeAll()}function scroll(e){var t=markers()[e];focusedMarker(e),moveToMarker(markers()[e]),infoWindow.closeAll(t),infoWindow.populate(t,new google.maps.InfoWindow),$("#swipe_list").animate({scrollLeft:$(".location_switcher_swipe_list_item")[e].offsetLeft-$(".location_switcher_swipe_list_item").eq(e).width()/2},200)}function swipeLeft(){focusedMarker()-1>=0&&focusedMarker()-1<markers().length&&scroll(focusedMarker()-1)}function swipeRight(){focusedMarker()+1>=0&&focusedMarker()+1<markers().length&&scroll(focusedMarker()+1)}function moveToMarker(e){var t={lat:e.position.lat(),lng:e.position.lng()};map.panTo(t)}function initMap(){function e(e){console.log(e),null!==e.getAnimation()?e.setAnimation(null):e.setAnimation(google.maps.Animation.BOUNCE)}function t(){for(var e=new google.maps.LatLngBounds,t=0;t<markers().length;t++)markers()[t].setMap(map),e.extend(markers()[t].position);map.fitBounds(e)}console.log("creating map");var i=[{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"transit.station",stylers:[{weight:9},{hue:"#e85113"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]}];map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.7413549,lng:-73.9980244},zoom:13,styles:i,mapTypeControl:!1});for(var o=0;o<favoriteLocations.length;o++){var r=new google.maps.Marker({position:favoriteLocations[o].location,title:favoriteLocations[o].title,koTitle:ko.observable(favoriteLocations[o].title),index:o,type:favoriteLocations[o].type,visible2:ko.observable(!0),wikipedia:{url:ko.observable(""),ingress:ko.observable(""),bodyText:ko.observable("")},flickr:{img:ko.observableArray([])}});r.addListener("click",function(){infoWindow.closeAll(this),infoWindow.populate(this,new google.maps.InfoWindow),e(markers()[o-1])}),markers.push(r)}t(),getExternalResources()}var map,markers,polygon,locations,focusedMarker,test,featuredContent=ko.observable({first:{title:ko.observable(),wikipedia:ko.observable({ingress:ko.observable(),bodyText:ko.observable(),url:ko.observable()}),flickr:ko.observable({img:ko.observableArray([])})}}),filter=ko.observable({type:{hike:ko.observable(!1),restaurant:ko.observable(!1),landmark:ko.observable(!1),toggleHike:function(){this.hike(!this.hike()),console.log("toggling hike() "+this.hike()),sendItemsToSearch($(".location_switcher_search_field").val())},toggleRestaurant:function(){this.restaurant(!this.restaurant()),console.log("toggling restaurant() "+this.restaurant()),sendItemsToSearch($(".location_switcher_search_field").val())},toggleLandmark:function(){this.landmark(!this.landmark()),console.log("toggling landmark() "+this.landmark()),sendItemsToSearch($(".location_switcher_search_field").val())}},active:function(){return this.type.hike()||this.type.restaurant()||this.type.landmark()?(console.log("Checked filters and some are active!!!"),!0):(console.log("Checked filters and none are active"),!1)}}),ViewModel=function(){markers=ko.observableArray(),markers.subscribe(function(e){console.log("Markers() got a new value! = "+markers())}),polygon=null,focusedMarker=ko.observable(0),this.test=function(){scroll(this.index),toggleLocationSwitcherList()},$("#location_switcher_center").click(function(){toggleLocationSwitcherList()})};ko.applyBindings(new ViewModel),window.onload=function(){setTimeout(function(){toggleLocationSwitcherList()},500)};var favoriteLocations=[{title:"Sverd i fjell",type:getKeywords("landmark"),location:{lat:58.9413738,lng:5.6713647}},{title:"Stavanger domkirke",type:getKeywords("landmark"),location:{lat:58.9696008,lng:5.7327193}},{title:"Kjeragbolten",type:getKeywords("hike"),location:{lat:59.0346734,lng:6.5753282}},{title:"Preikestolen",type:getKeywords("hike"),location:{lat:58.9857634,lng:6.1575914}},{title:"Trolltunga",type:getKeywords("hike"),location:{lat:60.124167,lng:6.7378113}},{title:"Sauanuten",type:getKeywords("hike"),location:{lat:59.8274041,lng:6.3854395}},{title:"Ulriken",type:getKeywords("hike"),location:{lat:60.3774889,lng:5.3847581}}];$(".location_switcher_search_field").on("input",function(){sendItemsToSearch(this.value)}),sendItemsToSearch($(".location_switcher_search_field").val());var markersLength=markers().length,ajaxRunTimes=0,ajax={title:"",flickr:{key:"e896b44b17e42a28558673f7db2b3504",url:"https://www.flickr.com/services/rest/"},nasjonalturbase:{key:"9718dda12c871525b0c2d976e02986c68de29abe",url:"http://api.nasjonalturbase.no/v0/turer/"}},wikipediaErrorHandling=setTimeout(function(){console.log("Wikipedia Ajax calls timed out!")},5e3),featured={displaying:!1},locationList={displaying:!0},locationSwitcher={displaying:!0},infoWindow={populate:function(e,t){e.infoWindow||(e.infoWindow=new google.maps.InfoWindow,console.log("Created new infoWindow (for marker "+e.index+") = "+e.infoWindow)),e.infoWindow.setContent('<div style="width: 200px;"><h5>'+e.title+"</h5><p>"+markers()[e.index].wikipedia.ingress()+'</p><p><a onclick="readMore('+e.index+')">Les meir</a></p></div>'),e.infoWindow.addListener("closeclick",function(){e.infoWindow.close()}),e.infoWindow.open(map,e)},closeAll:function(e){for(var t=markers().length,i=0;i<t;i++)e?markers()[i].koTitle()!==e.koTitle()&&markers()[i].infoWindow&&null!==markers()[i].infoWindow.anchor&&markers()[i].infoWindow.close():markers()[i].infoWindow&&markers()[i].infoWindow.close()}};